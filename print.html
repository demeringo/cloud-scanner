<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Boavizta cloud scanner üì°</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="intro.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Tutorials üöÄ</li><li class="chapter-item expanded "><a href="tutorials/quickstart-docker.html"><strong aria-hidden="true">1.</strong> Quickstart - using CLI docker üê≥</a></li><li class="chapter-item expanded "><a href="tutorials/quickstart-dashboard-docker.html"><strong aria-hidden="true">2.</strong> Quickstart - dashboard using docker üê≥</a></li><li class="chapter-item expanded "><a href="tutorials/quickstart-rust-cli.html"><strong aria-hidden="true">3.</strong> Quickstart - using cargo ü¶Ä</a></li><li class="chapter-item expanded "><a href="tutorials/quickstart-serverless.html"><strong aria-hidden="true">4.</strong> Quickstart as serverless ‚ö°</a></li><li class="chapter-item expanded affix "><li class="part-title">Explanations</li><li class="chapter-item expanded "><a href="explanations/methodology.html"><strong aria-hidden="true">5.</strong> Methodology</a></li><li class="chapter-item expanded "><a href="explanations/processing-workload.html"><strong aria-hidden="true">6.</strong> How we process workload</a></li><li class="chapter-item expanded affix "><li class="part-title">How-to guides</li><li class="chapter-item expanded "><a href="how-to/building-cli.html"><strong aria-hidden="true">7.</strong> Building CLI</a></li><li class="chapter-item expanded "><a href="how-to/docker-guide.html"><strong aria-hidden="true">8.</strong> Run as docker</a></li><li class="chapter-item expanded "><a href="how-to/deploy-sls.html"><strong aria-hidden="true">9.</strong> Deploy serverless</a></li><li class="chapter-item expanded "><a href="how-to/passing-aws-credentials.html"><strong aria-hidden="true">10.</strong> AWS authentication</a></li><li class="chapter-item expanded "><a href="how-to/set-up-dashboard.html"><strong aria-hidden="true">11.</strong> Setup monitoring dashboard</a></li><li class="chapter-item expanded "><a href="how-to/filter-by-tags.html"><strong aria-hidden="true">12.</strong> Filtering by tags</a></li><li class="chapter-item expanded "><a href="how-to/using-private-boaviztapi.html"><strong aria-hidden="true">13.</strong> Using a private instance of Boavizta API</a></li><li class="chapter-item expanded affix "><li class="part-title">Reference</li><li class="chapter-item expanded "><a href="reference/common-issues-and-FAQ.html"><strong aria-hidden="true">14.</strong> üí° Common issues and FAQ</a></li><li class="chapter-item expanded "><a href="reference/cli-options.html"><strong aria-hidden="true">15.</strong> CLI options</a></li><li class="chapter-item expanded "><a href="reference/env-vars.html"><strong aria-hidden="true">16.</strong> Environment variables</a></li><li class="chapter-item expanded "><a href="reference/openapi-server-mode.html"><strong aria-hidden="true">17.</strong> OpenAPI specification in server mode</a></li><li class="chapter-item expanded "><a href="reference/output-data.html"><strong aria-hidden="true">18.</strong> Output data</a></li><li class="chapter-item expanded "><a href="reference/serverless-design.html"><strong aria-hidden="true">19.</strong> Serverless design</a></li><li class="chapter-item expanded "><a href="reference/limits.html"><strong aria-hidden="true">20.</strong> Limitations</a></li><li class="chapter-item expanded "><a href="reference/testing.html"><strong aria-hidden="true">21.</strong> Unit tests</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Boavizta cloud scanner üì°</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/Boavizta/cloud-scanner" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <p><img src="images/cloudscanner_color_logo.svg" alt="Cloud scanner logo" /></p>
<h1 id="about-cloud-scanner"><a class="header" href="#about-cloud-scanner">About cloud-scanner</a></h1>
<p><a href="https://github.com/Boavizta/cloud-scanner">Boavizta Cloud-scanner</a> returns environmental impacts of your AWS Instances (EC2) and Storage usage.</p>
<pre class="mermaid">  graph LR;
      inventory[ Account inventory] 
      api[Impacts from BoaviztaAPI]
      metrics[Prometheus metrics]
      json[JSON output]
      inventory --&gt; api
      api --&gt; metrics
      api --&gt; json
</pre>
<p>It combines real time <em>inventory</em> and <em>usage</em> data from your AWS account with <a href="https://github.com/Boavizta/boaviztapi/">Boavizta API</a> to offer a  view of your impacts on a given region.</p>
<ul>
<li>multi criteria: Primary Energy consumption (PE), Abiotic resource depletion potential (ADP), and Global Warming Potential (GWP)</li>
<li>multi stage: separate impacts of ressources Usage and Manufacture</li>
</ul>
<p>Estimations can be filtered by tags. It eases attribution to a specific server, environment, application or service.</p>
<p>Cloud-scanner can be used:</p>
<ul>
<li>from command line, to get an immediate view of your impacts üíª</li>
<li>as a metric server . You can use it to monitor and display real time impacts in a dashboard üìä</li>
</ul>
<p><img src="images/cloud-scanner-dashboard-clear.png" alt="A example dashboard rendering cloud scanner metrics" title="A example dashboard rendering cloud scanner metrics" /></p>
<p>Cloud-scanner is an Open Source application maintained here: <a href="https://github.com/Boavizta/cloud-scanner">https://github.com/Boavizta/cloud-scanner</a>.</p>
<h2 id="how-it-works"><a class="header" href="#how-it-works">How it works</a></h2>
<p><img src="images/cloud-scanner-system-in-context.png" alt="System in context diagram of cloud scanner" title="System in context diagram of cloud scanner" /></p>
<p>Cloud scanner relies on cloud providers APIs to perform an inventory of your cloud resources.  It collects information about usage (instance types, tags, CPU load or volume size).</p>
<p>This inventory is used to query Boavizta API which returns impact data.</p>
<p>Results are exposed as JSON or metrics.</p>
<h2 id="contributing"><a class="header" href="#contributing">Contributing</a></h2>
<p>Cloud scanner is stable, but with limited functionality.</p>
<p>Development versions may already provide new functionalities that have not yet be included to a release. So have a look at the <a href="https://github.com/Boavizta/cloud-scanner/blob/main/CHANGELOG.md">changelog</a> and <a href="https://github.com/Boavizta/cloud-scanner/issues">Issues</a> on this repository.</p>
<p>And most importantly, do not hesitate to ask questions or share your feedback by opening an <a href="https://github.com/Boavizta/cloud-scanner/issues">Issue</a> or <a href="https://github.com/Boavizta/cloud-scanner/discussions">discussion</a> on GitHub.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="quick-start-run-cli-using-docker-"><a class="header" href="#quick-start-run-cli-using-docker-">Quick start run CLI using docker üê≥</a></h1>
<p>No installation needed, you will run a public docker image of cloud-scanner CLI.</p>
<h2 id="pre-requisites"><a class="header" href="#pre-requisites">Pre-requisites</a></h2>
<ul>
<li>Docker.</li>
<li>A working AWS account (and your AWS CLI profile already configured)</li>
</ul>
<h2 id="run-cloud-scanner-cli"><a class="header" href="#run-cloud-scanner-cli">Run cloud-scanner cli</a></h2>
<pre><code class="language-sh">docker pull ghcr.io/boavizta/cloud-scanner-cli:latest
docker run -it ghcr.io/boavizta/cloud-scanner-cli:latest --help

# Ensure you have a working AWS profile setup locally (like you would do for AWS CLI)
# Note
# - we map local credentials on the container (-v)
# - we force a using 'myprofile' profile by setting the AWS_PROFILE environment variable with -e flag
# - the -it flag is optional, only purpose is to get colored output if any

# Just list instances
docker run -it -v $HOME/.aws/credentials:/root/.aws/credentials:ro -e AWS_PROFILE='myprofile' ghcr.io/boavizta/cloud-scanner-cli:latest inventory

# List instances and standard impacts (for 10 hours of use)
docker run -it -v $HOME/.aws/credentials:/root/.aws/credentials:ro -e AWS_PROFILE='myprofile' ghcr.io/boavizta/cloud-scanner-cli:latest estimate --use-duration-hours 10

# Serve metrics
``` sh
# Note that we need to provide ca certificates and bind  listen address to 0.0.0.0.
docker run -it -p 8000:8000 -v /etc/ssl/certs/ca-certificates.crt:/etc/ssl/certs/ca-certificates.crt -v $HOME/.aws/credentials:/root/.aws/credentials:ro -e ROCKET_ADDRESS=0.0.0.0 -e ROCKET_PORT=8000 -e AWS_PROFILE='myprofile'  ghcr.io/boavizta/cloud-scanner-cli:latest serve
</code></pre>
<p>‚ö† This method of passing credentials is not secure nor very practical. In a production setup on AWS, you should rather rely on the role of the instance that execute the container to manage authentication of the cli.</p>
<p>‚ö† Running metric server in container require setting  extra variables:</p>
<ul>
<li>to map AWS credentials</li>
<li>to map SSL ca certificates</li>
<li>and more importantly to configure Rocket to listen to 0.0.0.0 instead of default 127.0.0.1 (which is internal to the container. This is done with the extra variable: <code>ROCKET_ADDRESS=0.0.0.0</code></li>
</ul>
<p>Alternatively you may build and use a local docker image, See <a href="tutorials/../how-to/docker-guide.html#build-a-local-docker-image">build a local docker image</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="quick-start--display-dashboard-using-docker-compose-"><a class="header" href="#quick-start--display-dashboard-using-docker-compose-">Quick start : display dashboard using docker-compose üê≥</a></h1>
<p>Visualize the live impacts of you account in a dashboard.</p>
<p>No installation needed, you will run a public docker image of cloud-scanner CLI, Boavizta API, Prometheus and Grafana to get access to a demo dashboard..</p>
<p>All data remain  local to your environment (this docker-compose stack uses a <em>private instance</em> of Boavizta API).</p>
<h2 id="pre-requisites-1"><a class="header" href="#pre-requisites-1">Pre-requisites</a></h2>
<ul>
<li>Docker and docker-compose</li>
<li>A working AWS account (and your AWS CLI profile already configured)</li>
</ul>
<p><img src="tutorials/../images/cloud-scanner-metrics-compose.excalidraw.png" alt="components of monitoring stack in docker compose" /></p>
<h2 id="run-the-demo-dashboard"><a class="header" href="#run-the-demo-dashboard">Run the demo dashboard</a></h2>
<pre><code class="language-sh"># Map your AWS credentials
export AWS_PROFILE=name-of-your-profile
# Start the stack (from the root of the repository)
docker-compose up
</code></pre>
<ul>
<li>Demo dashboard is exposed on http://localhost:3001</li>
<li>Log in with user admin/admin</li>
<li>Select the dashboard in the left menu.</li>
</ul>
<p><img src="tutorials/../images/CS-dashboard.png" alt="Demo dashboard exposing cloud scanner metrics" title="A example dashboard rendering cloud scanner metrics" /></p>
<p>‚ö† The demo docker-compose is preconfigured to generate metrics only for the following regions:</p>
<ul>
<li>eu-west-1</li>
<li>eu-west-3</li>
<li>eu-central-1</li>
<li>us-east-1</li>
</ul>
<p>Refer to  <a href="tutorials/../how-to/set-up-dashboard.html#generating-metrics-for-additional-regions">Generating metrics for additional regions</a> to retrieve metrics for additional regions.</p>
<h2 id="additional-info"><a class="header" href="#additional-info">Additional info</a></h2>
<ul>
<li>‚ö† This docker-compose example is <strong>not</strong> intended  for production deployment, but rather for quick testing.
<ul>
<li>ports of all services are exposed.</li>
<li>Grafana is served on http with default login.</li>
</ul>
</li>
<li>You may have to update the line mapping your AWS profile (Replace <code>AWS_PROFILE=${AWS_PROFILE}</code> by <code>AWS_PROFILE=the-real-name-of-your-profile</code>) when using Podman. It seems that Podman compose does not map the variables of the environment to the containers.</li>
<li>In corporate environments, you may need to provide your certificates authorities certificates (<code>ca-certificates</code>) to the cloud-scanner container (uncomment the mapping line in the docker-compose file).</li>
<li>For the demo, we deliberately set a short metrics scrapping interval (30 seconds). In a production environment, you may want to increase this metric scraping interval to reduce the API calls and volume of data. This scrapping period is set in the Prometheus configuration file.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="quick-start---run-cli-using-cargo-"><a class="header" href="#quick-start---run-cli-using-cargo-">Quick start - Run CLI using Cargo ü¶Ä</a></h1>
<p>This quick start will show the impacts of your EC2 instances for 10 hours of use, by building a local version of the cloud-scanner CLI from source.</p>
<h2 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h2>
<ul>
<li>a Rust toolchain installed locally <a href="https://rustup.rs/">rustup.rs - The Rust toolchain installer</a></li>
<li>A working AWS account (and you AWS CLI profile already configured)</li>
<li>optional: <a href="https://stedolan.github.io/jq/">jq</a> to format json results</li>
</ul>
<h2 id="compile-an-run-cli-"><a class="header" href="#compile-an-run-cli-">Compile an run CLI üíª</a></h2>
<ol>
<li>Clone the cloud-scanner repository</li>
<li>build and run CLI</li>
</ol>
<pre><code class="language-sh"># Ensure you have a working AWS profile setup locally (like you would do for AWS CLI)
export AWS_PROFILE='&lt;YOUR_PROFILE_NAME&gt;'

# Get impacts of 10 hours of use (on your default account region)
cargo run estimate --use-duration-hours 10 | jq

# Same thing but as metrics
cargo run -- --as-metrics estimate --use-duration-hours 10

# Same query for explicit region
cargo run -- --aws-region eu-west-3 estimate --use-duration-hours 10 | jq
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="use-cloud-scanner-as-a-serverless--application"><a class="header" href="#use-cloud-scanner-as-a-serverless--application">Use cloud-scanner as a serverless  application‚ö°</a></h1>
<p>This will deploy the cloud-scanner <em>inside</em> your AWS account. You can use it to:</p>
<ul>
<li>scan the account to get json impacts (as you would do with the CLI)</li>
<li>or</li>
<li>get metrics (that you can scrape with prometheus or the monitoring system of your choice)</li>
</ul>
<p>The application is build and deployed using the serverless framework (see <a href="tutorials/../reference/serverless-design.html">serverless-design</a>).</p>
<h2 id="prerequisites-1"><a class="header" href="#prerequisites-1">Prerequisites</a></h2>
<p>The deployment creates an aws role configured to get sufficient permission to scan your resources without requesting end-user authentication.</p>
<ol>
<li>Nodejs installed locally</li>
<li>An AWS account/profile with sufficient permissions to deploy lambda, configure API gateway, and create a role.</li>
</ol>
<p>‚ö† The deployment process was only tested on Linux.</p>
<h2 id="deploy-the-application-"><a class="header" href="#deploy-the-application-">Deploy the application ‚ö°</a></h2>
<pre><code class="language-sh"># Install node the serverless framework and it's dependencies
npm i
export aws_profile = &lt;my profile&gt;
# Deploy the application to your AWS account
serverless deploy
</code></pre>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<h3 id="scan-the-account--region-"><a class="header" href="#scan-the-account--region-">Scan the account / region üíª</a></h3>
<p>This returns results in json format (see below, same as CLI)</p>
<p>https://xxxxx.execute-api.eu-west-1.amazonaws.com/dev/scan?hours_use_time=5&amp;aws_region=eu-west-1</p>
<p>Use <code>hours_use_time</code> and <code>aws_region</code> parameters in the query to pass the values to the lambda.</p>
<h3 id="get-metrics-"><a class="header" href="#get-metrics-">Get Metrics üìä</a></h3>
<p>https://xxxxx.execute-api.eu-west-1.amazonaws.com/dev/metrics?aws_region=eu-central-1</p>
<p>Returns metrics for <strong>1 hour of use</strong> in prometheus format.</p>
<p>The metrics represent the costs / impacts of one hour of use of the resources present in your account at the time of the query.</p>
<p>Use <code>aws_region</code> parameters in the query.</p>
<pre><code class="language-plaintext"># HELP boavizta_number_of_instances_total Number of instances detected during the scan.
# TYPE boavizta_number_of_instances_total gauge
boavizta_number_of_instances_total{awsregion="eu-central-1",country="DEU"} 7
# HELP boavizta_number_of_instances_assessed Number of instances that were considered in the measure.
# TYPE boavizta_number_of_instances_assessed gauge
boavizta_number_of_instances_assessed{awsregion="eu-central-1",country="DEU"} 5
# HELP boavizta_duration_of_use_hours Number of instances detected during the scan.
# TYPE boavizta_duration_of_use_hours gauge
boavizta_duration_of_use_hours{awsregion="eu-central-1",country="DEU"} 1.0
# HELP boavizta_pe_manufacture_megajoules Power consumed for manufacture.
# TYPE boavizta_pe_manufacture_megajoules gauge
boavizta_pe_manufacture_megajoules{awsregion="eu-central-1",country="DEU"} 1760.0
# HELP boavizta_pe_use_megajoules Power consumed during usage.
# TYPE boavizta_pe_use_megajoules gauge
boavizta_pe_use_megajoules{awsregion="eu-central-1",country="DEU"} 0.86
# EOF
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="methodology-and-source-of-data"><a class="header" href="#methodology-and-source-of-data">Methodology and source of data</a></h1>
<p>Cloud scanner uses the Boavizta methodology to estimate the impacts of cloud resources.</p>
<h2 id="source-of-impact-data"><a class="header" href="#source-of-impact-data">Source of impact data</a></h2>
<p>Impact data is retrieved from <a href="https://github.com/Boavizta/boaviztapi/">BOAVIZTA reference data API</a> v1.2.x.</p>
<h2 id="methodology"><a class="header" href="#methodology">Methodology</a></h2>
<p>The general approach of Boavizta is described in <a href="https://boavizta.org/en/blog/empreinte-de-la-fabrication-d-un-serveur">Digital &amp; environment : How to evaluate server manufacturing footprint, beyond greenhouse gas emissions? | Boavizta</a></p>
<p>The impacts (use and embedded) are attributed according to the principles described in <a href="https://doc.api.boavizta.org/Explanations/services/cloud/">Cloud instances - Boavizta API documentation</a>.</p>
<p>The results are similar to what you can visualize in <a href="http://datavizta.boavizta.org/cloudimpact">Datavizta</a>, but with automated inventory.</p>
<p>‚ö† Cloud scanner <strong>underestimates the impacts of the cloud resources</strong>. Because it only considers the <em>instances</em> and <em>block storage</em> a several sources of impacts (network, potential redundancy, cloud control plan) are not included in the estimation.</p>
<p>See also <a href="explanations/../reference/limits.html">other limits</a>.</p>
<ul>
<li>https://www.boavizta.org/en</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-we-process-workload"><a class="header" href="#how-we-process-workload">How we process workload</a></h1>
<p>Workload of instances are estimated using AWS cloudwatch CPU metrics summary.</p>
<p>Cloud scanner uses a sampling period of 15 minutes, but impacts metrics are returned as impacts equivalent to one hour of use.</p>
<p>This means that instance impacts metrics data returned can be understood as: <code>impact for one hour of use (considering  the CPU workload of 15 last minutes)</code>.</p>
<p>Why this default sampling period of 15 minutes ?</p>
<ul>
<li>It seems sufficient for our current monitoring needs (but maybe we can make it configurable in the future).</li>
<li>It seems hard to go below 10 minutes (because default period of AWS instance metrics is 5 minutes. You need to activate <code>detailed monitoring</code> (extra feature) for 1 minute granularity: <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/viewing_metrics_with_cloudwatch.html#ec2-cloudwatch-metrics">List the available CloudWatch metrics for your instances - Amazon Elastic Compute Cloud</a>).</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="building-cloud-scanner-cli-with-cargo-"><a class="header" href="#building-cloud-scanner-cli-with-cargo-">Building cloud-scanner CLI with Cargo ü¶Ä</a></h1>
<h2 id="on-linux"><a class="header" href="#on-linux">On Linux</a></h2>
<p>Install Rust and linux-musl dependencies.</p>
<pre><code class="language-sh"># Install rust (see https://www.rust-lang.org/tools/install), validate when prompted
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source "$HOME/.cargo/env"
# Add Linux musl target (needed for cross compilation for aws lambda)
rustup target add x86_64-unknown-linux-musl

sudo apt update &amp;&amp; sudo apt install -y musl-tools musl-dev

# Test a build
cargo build

#  build a release
cargo build --release
</code></pre>
<h2 id="on-windows-with-wsl2"><a class="header" href="#on-windows-with-wsl2">On Windows with WSL2</a></h2>
<p>Tested method to build Rust on Windows is to use <em>Windows Subsystem For Linux</em> (WSL2)</p>
<ol>
<li>Prerequisite: install WSL2 and  the latest Ubuntu LTS image (22.04).
<em>If you do not WSL yet, you may inspire from <a href="https://docs.microsoft.com/en-us/windows/dev-environment/javascript/nodejs-on-wsl">Set up Node.js on WSL 2</a>.</em></li>
<li>After WSL is setup, follow Linux instructions above inside the Linux VM.</li>
</ol>
<h2 id="using-docker"><a class="header" href="#using-docker">Using docker</a></h2>
<p>See <a href="how-to/./docker-guide.html#build-a-local-docker-image">Build a local docker image</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="usage-with-docker-"><a class="header" href="#usage-with-docker-">Usage with Docker üê≥</a></h1>
<h2 id="build-a-local-docker-image"><a class="header" href="#build-a-local-docker-image">Build a local docker image</a></h2>
<pre><code class="language-sh"># Local build of docker image
docker build . --tag cloud-scanner-cli
# Test run
docker run -it cloud-scanner-cli --help
</code></pre>
<h2 id="run-cloud-scanner-as-a-docker-image"><a class="header" href="#run-cloud-scanner-as-a-docker-image">Run cloud-scanner as a docker image</a></h2>
<p>See <a href="how-to/../tutorials/quickstart-docker.html">Quickstart using docker</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="deploy-cloud-scanner-as-a-serverless-application"><a class="header" href="#deploy-cloud-scanner-as-a-serverless-application">Deploy cloud scanner as a serverless application</a></h1>
<p>You can deploy cloud scanner as a serverless application (AWS lambda).</p>
<p>The application is build and deployed using the serverless framework (see <a href="how-to/../reference/serverless-design.html">serverless-design</a>).</p>
<h2 id="using-linux"><a class="header" href="#using-linux">Using Linux</a></h2>
<ol>
<li>Install Rust</li>
<li>Install nvm, nodejs</li>
<li>test serverless package</li>
</ol>
<p>First, don‚Äôt forget to clone the repo using</p>
<pre><code class="language-sh">git clone https://github.com/Boavizta/cloud-scanner.git
cd cloud-scanner
</code></pre>
<h3 id="install-rust"><a class="header" href="#install-rust">Install Rust</a></h3>
<pre><code class="language-sh"># Install rust (see https://www.rust-lang.org/tools/install), validate when prompted
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source "$HOME/.cargo/env"
# Add Linux musl target (needed for cross compilation for lambda)
rustup target add x86_64-unknown-linux-musl

sudo apt update &amp;&amp; sudo apt install -y musl-tools musl-dev
</code></pre>
<h3 id="install-node-for-serverless-deployment"><a class="header" href="#install-node-for-serverless-deployment">Install node (for serverless deployment)</a></h3>
<p>nvm, node.js and npm</p>
<p>See https://docs.microsoft.com/en-us/windows/dev-environment/javascript/nodejs-on-wsl</p>
<pre><code class="language-sh">sudo apt-get install curl

# Install nvm
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash
# Install node
nvm install --lts
</code></pre>
<h3 id="install-serverless-framework-and-deps"><a class="header" href="#install-serverless-framework-and-deps">Install serverless framework and deps</a></h3>
<pre><code class="language-sh">npm install -g serverless
npm i
</code></pre>
<h3 id="configure-environment"><a class="header" href="#configure-environment">Configure environment</a></h3>
<p>Everything you need should now be installed, but there is a last step you have to do before deploying. Since the serverless framework automatically deploys the lambda onto your AWS instance without you having to upload a zip file or anything, you have to give it access to it by giving it an access key (see <a href="https://www.serverless.com/framework/docs/providers/aws/guide/credentials">this guide</a> for more informations on how to generate an access keys).</p>
<pre><code class="language-sh">serverless config credentials \
  --provider aws \
  --key YOURACCESSKEY \
  --secret YOURSECRETKEY
</code></pre>
<p>Optionally, you can config a private instance of Boaviztapi by setting the environment variable <code>BOAVIZTA_API_URL</code> so :</p>
<pre><code class="language-sh">export BOAVIZTA_API_URL="boaviztapi.example.com"
</code></pre>
<p>If the environment variable is not set, cloud scanner will use the public instance (https://api.boavizta.org) by default.</p>
<h3 id="deploy"><a class="header" href="#deploy">Deploy</a></h3>
<p>You should be good to go by now, simply run</p>
<pre><code class="language-sh">serverless package
serverless deploy
</code></pre>
<p>and wait for it to be done. You should by now see two lamda functions appear on your AWS instance, Congratulations !</p>
<p>If any error happen, redo those steps carefully and make sure you didn‚Äôt miss anything before posting a GitHub Issue.</p>
<h2 id="using-windows"><a class="header" href="#using-windows">Using Windows</a></h2>
<p>Tested method to deploy this serverless app from on windows is to use Windows Subsystem For Linux (WSL2).</p>
<ol>
<li>Prerequisite: install WSL2 and  the latest Ubuntu LTS image (22.04).
<em>If you do not have it yet, you may inspire from <a href="https://docs.microsoft.com/en-us/windows/dev-environment/javascript/nodejs-on-wsl">Set up Node.js on WSL 2</a>.</em></li>
<li>After WSL is setup, follow Linux instructions above inside the Linux VM.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="aws-authentication"><a class="header" href="#aws-authentication">AWS authentication</a></h1>
<p>Cloud scanner uses AWS Rust SDK to query AWS account. By default Rust SDK picks up AWS credentials from environment variables.</p>
<h2 id="aws-permissions-required-by-cloud-scanner"><a class="header" href="#aws-permissions-required-by-cloud-scanner">AWS permissions required by Cloud Scanner</a></h2>
<p>üî• An Important pre-requisite is to have a <em>user</em> with sufficient permissions to list resources of the account (or an instance profile / role pre-configured when running cloud-scanner from EC2).</p>
<p>The minimal set of permissions to perform inventory of resources (and query CPU load of instances) is:</p>
<ul>
<li>ec2:DescribeInstances</li>
<li>cloudwatch:GetMetricStatistics</li>
<li>cloudwatch:DescribeAlarm</li>
</ul>
<p>You could also restricts permissions to a specific set of instances or resources.</p>
<h2 id="pass-credentials-as-environment-variables"><a class="header" href="#pass-credentials-as-environment-variables">Pass credentials as environment variables</a></h2>
<h3 id="option-1-use-aws_access_key_id-and-aws_secret_access_key"><a class="header" href="#option-1-use-aws_access_key_id-and-aws_secret_access_key">Option 1: Use AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY</a></h3>
<p>Set environment variables with your account detail.</p>
<pre><code class="language-sh"># Example for Linux / macOS
export AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
export AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
export AWS_DEFAULT_REGION=eu-west-1
</code></pre>
<p><em>See <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-envvars.html">https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-envvars.html</a> for equivalent Windows command prompt or Powershell syntax example.</em></p>
<h3 id="option-2--use-a-an-existing-aws_profile"><a class="header" href="#option-2--use-a-an-existing-aws_profile">Option 2:  Use a an existing AWS_PROFILE</a></h3>
<p>If you have configured an AWS CLI profile, the easiest way to pass aws credential to cloud scanner  is use an environment variable that points to this profile.</p>
<p>Pre-requisite to use a profile:</p>
<ol>
<li>AWS CLI <em>installed</em>: <a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html">Installing or updating the latest version of the AWS CLI - AWS Command Line Interface</a></li>
<li>AWS CLI <em>configured</em>: <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html">Configure the AWS CLI - AWS Command Line Interface</a>.</li>
</ol>
<pre><code class="language-sh"># Example for Linux / macOS
# cloud-scanner can use the AWS_PROFILE set as en environment variable.
# You have to reference one of the profiles previously configured in ~/.aws/credentials
export AWS_PROFILE=YOUR_PROFILE_NAME_EXAMPLE
export AWS_DEFAULT_REGION=eu-west-3
</code></pre>
<p><em>See <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-envvars.html">https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-envvars.html</a> for equivalent Windows command prompt or Powershell syntax example.</em></p>
<h2 id="reference"><a class="header" href="#reference">Reference</a></h2>
<p>See <a href="https://docs.aws.amazon.com/sdk-for-rust/latest/dg/credentials.html">Specify your credentials and default Region - AWS SDK for Rust</a> for more options to pass credentials to the SDK.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="integrate-metrics-to-a-monitoring-dashboard"><a class="header" href="#integrate-metrics-to-a-monitoring-dashboard">Integrate metrics to a monitoring dashboard</a></h1>
<p>Cloud-scanner can be used to export metrics related to the impact of your cloud account.</p>
<p>The metrics are exposed in Prometheus/OpenMetrics format. You can use it to feed a monitoring dashboard and keep an eye on the evolution of impacts of your usage.</p>
<p><img src="how-to/../images/cloud-scanner-dashboard-clear.png" alt="cloud-scanner-metrics-dashboard" /></p>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<ol>
<li>Start cloud-scanner in metrics mode (using the  <code>--serve</code>  option or by deploying it as a serverless application).</li>
<li>Setup Prometheus to scrape the metrics. Metrics are generated separately for each region.</li>
<li>Configure a dashboard to display the results.</li>
</ol>
<p><img src="how-to/../images/cloud-scanner-metrics-compose.excalidraw.png" alt="components of monitoring stack in docker compose" /></p>
<h2 id="detailed-steps"><a class="header" href="#detailed-steps">Detailed steps</a></h2>
<h3 id="demo-for-some-eu-regions"><a class="header" href="#demo-for-some-eu-regions">Demo for some EU regions.</a></h3>
<p>You can refer to  the provided <a href="how-to/../tutorials/quickstart-dashboard-docker.html">docker compose example </a> for a quick start.</p>
<p>It comes preconfigured to generate metrics for the following regions:</p>
<ul>
<li>eu-west-1</li>
<li>eu-west-3</li>
<li>eu-central-1</li>
<li>us-east-1</li>
</ul>
<h3 id="generating-metrics-for-additional-regions"><a class="header" href="#generating-metrics-for-additional-regions">Generating metrics for additional regions.</a></h3>
<p>Examples of Prometheus and Grafana configuration files are located in the <a href="https://github.com/Boavizta/cloud-scanner/tree/main/dashboard-config">dashboard-config</a> directories.</p>
<p>To generate (and display) metrics for an additional region:</p>
<ol>
<li>Edit the prometheus configuration (<code>prometheus.yml</code>)</li>
<li>Add a new job  and set its region parameter like <code>aws_region: ['us-east-2']</code>.</li>
<li>Restart Prometheus container and verify that metrics are now collected for this region.</li>
</ol>
<p>In the exemple compose stack, prometheus admin GUI is exposed.  You can check status of the scrape targets at:  <a href="http://localhost:9090/targets">http://localhost:9090/targets</a>.</p>
<pre><code class="language-yml"># Extract from prometheus.yml
# Example extra job configuration to cover us-east-2
  - job_name: 'cloud-scanner-metrics-us-east-2'
    scheme: http
    static_configs:
      - targets: ['cloud_scanner_boa:8000']
        labels:
          group: 'production'
    metrics_path: '/metrics'
    params:
      aws_region: ['us-east-2']
      include_block_storage: ['true']
</code></pre>
<h3 id="adapting-configuration-for-production-use"><a class="header" href="#adapting-configuration-for-production-use">Adapting configuration for production use:</a></h3>
<p>In production environment, you may want to increase the  metrics scraping interval.</p>
<p>This It is set to 30 seconds in the sample prometheus configuration. In production you shoud increase this intervall (e.g. 10 minutes).</p>
<pre><code class="language-yml"># Prometheus scrapping interval / extract from prometheus.yml configuration
global:
  scrape_interval:     30s # By default, scrape targets every 30 seconds.
  evaluation_interval: 30s # Evaluate rules every 30 seconds.
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="filter-by-tags"><a class="header" href="#filter-by-tags">Filter by tags</a></h1>
<p>You can limit cloud-scanner results (metriccs or json) to the cloud resources that match specific tags.</p>
<p>You can use multiple tags.</p>
<p>Works with inventory or estimates.</p>
<h2 id="filter-in-cli"><a class="header" href="#filter-in-cli">Filter in cli</a></h2>
<pre><code class="language-sh"># Retrieve only resources with the following tags:
#  CustomTagNameForDebug=olivierdemeringoadm
#     and 
#  Name=test-boavizta
cargo run -- -t Name=test-boavizta-2 -t CreatorName=olivierdemeringoadm  inventory| jq
</code></pre>
<h2 id="filter-with-serverlesslambda"><a class="header" href="#filter-with-serverlesslambda">Filter (with serverless/lambda)</a></h2>
<p>Use one (or multiple) <code>filter_tag</code> parameter in the query string to restrict results.</p>
<pre><code class="language-sh"># Retrieve only resources with the following tags:
#  CustomTagNameForDebug=olivierdemeringoadm
#     and 
#  Name=test-boavizta
https://&lt;EDITED&gt;.execute-api.eu-west-1.amazonaws.com/dev/scan?use_duration_hours=5&amp;aws_region=eu-west-1&amp;filter_tag=CustomTagNameForDebug=olivierdemeringoadm&amp;filter_tag=Name=test-boavizta
</code></pre>
<h2 id="filter-metrics"><a class="header" href="#filter-metrics">Filter metrics</a></h2>
<p>Use the <code>filter_tag</code> query parameter in the URL.</p>
<p>It can be used multiple time (only instances matching <em>all</em> tags will be returned).</p>
<p>Example queries</p>
<ul>
<li><a href="http://localhost:8000/metrics?aws_region=eu-west-3&amp;filter_tag=Name=boatest&amp;filter_tag=OtherTag=other-value">http://localhost:8000/metrics?aws_region=eu-west-3&amp;filter_tag=Name=boatest&amp;filter_tag=OtherTag=other-value</a></li>
<li><a href="http://localhost:8000/metrics?aws_region=eu-west-3&amp;filter_tag=Name=boatest">http://localhost:8000/metrics?aws_region=eu-west-3&amp;filter_tag=Name=boatest</a></li>
<li><a href="http://localhost:8000/metrics?aws_region=eu-west-1&amp;filter_tag=Name=test-boavizta">http://localhost:8000/metrics?aws_region=eu-west-1&amp;filter_tag=Name=test-boavizta</a></li>
</ul>
<h2 id="important-limitation"><a class="header" href="#important-limitation">Important limitation</a></h2>
<p>Suppose the following instances (and tags)</p>
<ul>
<li>
<p>instance1 (</p>
<ul>
<li>ENV=prod</li>
<li>PURPOSE=CI</li>
</ul>
</li>
<li>
<p>instance2</p>
<ul>
<li>ENV=prod</li>
<li>PURPOSE=service</li>
</ul>
</li>
<li>
<p>Filtering on ‚ÄúENV=prod‚Äù will return instance1 and instance2</p>
</li>
<li>
<p>Filtering on ‚ÄúENV=prod‚Äù and PURPOSE=CI will return only instance2</p>
</li>
<li>
<p>No filter will return <em>all</em> instances</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="using-a-private-instance-of-boavizta-api"><a class="header" href="#using-a-private-instance-of-boavizta-api">Using a private instance of Boavizta API</a></h1>
<p>To avoid that the scanner shares your inventory data to the public version of Boavizta API,  It is recommended to deploy your own instance of Boavizta API.</p>
<p>This is also useful if you want to stick to a specific version of the API.</p>
<p>The Boavizta API can be deployed in several ways (docker, lambda a.s.o.). Refer to the API documentation: <a href="https://doc.api.boavizta.org/Reference/deploy/">Deploy - Boavizta API documentation</a> or refer to the provided <a href="how-to/../tutorials/quickstart-dashboard-docker.html">docker compose example</a> for an example of integration cloud-scanner and a private instance of the API.</p>
<p>Once you have deployed your instance of API, use either the command line flags (CLI) or environment variable (docker, lambda) to configure the scanner to use <em>your</em> API instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="common-issues-and-faq"><a class="header" href="#common-issues-and-faq">Common issues and FAQ</a></h1>
<h2 id="the-demo-dashboard-does-not-show-any-metric"><a class="header" href="#the-demo-dashboard-does-not-show-any-metric">The demo dashboard does not show any metric‚Ä¶</a></h2>
<p>Several reasons may explain why metrics do not appear in the dashboard.</p>
<ol>
<li>Verify in the docker-compose logs that there is no error related to AWS authentication.</li>
<li>Check that prometheus is configured to retrieve metrics for the region you use.</li>
</ol>
<p>‚ö† The demo docker-compose is preconfigured to generate metrics only for the following regions:</p>
<ul>
<li>eu-west-1</li>
<li>eu-west-3</li>
<li>eu-central-1</li>
<li>us-east-1</li>
</ul>
<p>Refer to  <a href="reference/../how-to/set-up-dashboard.html#generating-metrics-for-additional-regions">Generating metrics for additional regions</a> to retrieve metrics for additional regions.</p>
<h2 id="the-docker-compose-demo-may-not-display-the-latest-version-of-the-grafana-dashboard"><a class="header" href="#the-docker-compose-demo-may-not-display-the-latest-version-of-the-grafana-dashboard">The docker compose demo may not display the latest version of the Grafana dashboard</a></h2>
<p>/!\ The existing Grafana volume is preserved even after deploying a newer version of the docker-compose demo stack.</p>
<p>As a consequence the Grafana provisioning does not occur. Any update of the demo dashboard provided with the new stack is not reflected in the instance, even if Grafana container itself is recreated.</p>
<h3 id="workaround"><a class="header" href="#workaround">Workaround</a></h3>
<p>We have 2 possibilities, depending if we want to preserve the existing Grafana configuration (volume) or not.</p>
<ul>
<li><em>Preserve</em> the existing volume if it was previously customized to contain additional Grafana configuration (outside cloud scanner) or if you add custom dashboards.</li>
<li>Delete the volume if you use a vanilla instance of cloud-scanner demo.</li>
</ul>
<h4 id="updating-the-dashboard-while-keeping-existing-volume"><a class="header" href="#updating-the-dashboard-while-keeping-existing-volume">Updating the dashboard while keeping existing volume</a></h4>
<p>Wee need to <strong>upload the new dashboard</strong> definition manually <strong>using  the Grafana web UI.</strong></p>
<ul>
<li>The dashboard definition can be found under <code>dashboard-config/provisioning/dashboards/</code>: <a href="https://github.com/Boavizta/cloud-scanner/blob/main/dashboard-config/provisioning/dashboards/grafana-dashboard-cloud-impacts.template.json">grafana-dashboard-cloud-impacts.template.json</a></li>
<li>By default Grafana UI is exposed at <code>http://&lt;host-ip&gt;:3001</code></li>
</ul>
<h4 id="updating-the-dashboard-by-recreating-grafana-configuration-from-scratch"><a class="header" href="#updating-the-dashboard-by-recreating-grafana-configuration-from-scratch">Updating the dashboard by recreating Grafana configuration from scratch</a></h4>
<p>/!\ Use this method only if Grafana was <strong>not</strong> customized after deployment of the demo or you are ok to loose these changes.</p>
<p>The easiest is to delete the Grafana volume and Grafana container. They will be recreated, and Grafana provisioned with latest dashboard, when we restart the docker compose stack.</p>
<pre><code class="language-sh"># stop docker compose stack
docker compose down
# delete Grafana container (necessary because it may be using the volume even if stopped)
docker rm grafana_boa
# now delete volume
docker volume rm cloud-scanner_grafana-data
# Recreate compose stack
docker compose up
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cli-options"><a class="header" href="#cli-options">CLI options</a></h1>
<pre><code class="language-sh">List aws instances and their environmental impact (from Boavizta API)

Usage: cloud-scanner-cli [OPTIONS] &lt;COMMAND&gt;

Commands:
  estimate   Get estimation of impacts for a given usage duration
  inventory  List instances and  their average cpu load for the last 5 minutes (without returning impacts)
  serve      Run as a standalone server. Access metrics (e.g. http://localhost:8000/metrics?aws_region=eu-west-3), inventory or impacts (see http://localhost:8000/swagger-ui)
  help       Print this message or the help of the given subcommand(s)

Options:
  -a, --aws-region &lt;AWS_REGION&gt;
          AWS region (The default aws profile region is used if not provided)
  -b, --boavizta-api-url &lt;BOAVIZTA_API_URL&gt;
          Optional Boavizta API URL if you want to use your own instance (URL without the trailing slash, e.g. https://api.boavizta.org)
  -t, --filter-tags &lt;FILTER_TAGS&gt;
          Filter instances on tags (like tag-key-1=val_1 tag-key_2=val2)
  -v, --verbosity...
          Enable logging and show execution duration, use multiple `v`s to increase logging level warning to debug
  -h, --help
          Print help
  -V, --version
</code></pre>
<h2 id="experimental-feature-estimate-block-storage"><a class="header" href="#experimental-feature-estimate-block-storage">Experimental feature: estimate block storage</a></h2>
<p>Use the <code>--include-block-storage</code> command line flag or parameter to consider block storage (either in inventory or when requesting an estimation of impacts.). This parameter defaults to <code>false</code> . This means that by default block storage (volumes) are not counted in the inventory nor in the results.</p>
<p>‚ö† In any case, for storage, the impacts of the <em>use</em> phase are <em>not</em> counted. Boavizta API returns only the impacts of the <em>manufacturing</em> phase for HDD and SSD. Furthermore the impacts of storage are likely <em>are likely overestimated</em>. They are calculated by taking into account the size of the logical volume. In reality, a volume that is not full may not claim the full space on a physical device, which would result in smaller impacts.</p>
<pre><code class="language-sh"># Experimental: get impacts of instances and attached storage
cargo run estimate --use-duration-hours 1 --include-block-storage --output-verbose-json
</code></pre>
<h2 id="display-statistics"><a class="header" href="#display-statistics">Display statistics</a></h2>
<p>Use <code>-v</code> will display statistics on std error.</p>
<ul>
<li>First output line shows the time spend specifically gathering CPU load of instances.</li>
<li>Second line shows global statistics:
<ul>
<li>total inventory duration: total time taken to retrieve resource lists and CPU statistics from AWS.</li>
<li>impact estimation duration: time taken to query Boavizta API</li>
<li>total execution duration.</li>
</ul>
</li>
</ul>
<pre><code class="language-sh">cloud-scanner-cli -v estimate -u 1
# use -- -v with cargo
# cargo  run -- -v estimate -u 1
[...]
cloud_scanner_cli::aws_inventory: Total time spend querying CPU load of instances: 372.153481ms
cloud_scanner_cli: ExecutionStatistics { inventory_duration: 911.526773ms, impact_duration: 398.993816ms, total_duration: 1.310520822s }
[...]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="environment-variables"><a class="header" href="#environment-variables">Environment variables</a></h1>
<p>Cloud scanner uses environment variables to configure connection to your cloud account. See <a href="reference/../how-to/passing-aws-credentials.html">AWS authentication</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="format-of-results-in-server-mode"><a class="header" href="#format-of-results-in-server-mode">Format of results in server mode</a></h1>
<p>When run in server mode (<code>cloud-scanner-cli serve</code>), Cloud-scanner exposes 3 endpoints:</p>
<ul>
<li><code>/metrics</code>: returns Prometheus metrics (plain text)</li>
<li><code>/inventory</code>: returns an inventory  (json format, see schema below)</li>
<li><code>/impacts</code>: returns impacts (json format, see schema below)</li>
</ul>
<h2 id="open-api-specification-swagger"><a class="header" href="#open-api-specification-swagger">Open API specification (Swagger)</a></h2>
<p>The latest (up-to-date) version of OpenAPI specification is exposed under  <code>&lt;BaseURL&gt;/openapi.json</code> path and displayed using swagger-ui at <code>&lt;BaseURL&gt;/swagger-ui/index.html</code>.</p>
<pre><code class="language-json">{
  "openapi": "3.0.0",
  "info": {
    "title": "cloud-scanner-cli",
    "version": "2.0.4"
  },
  "paths": {
    "/metrics": {
      "get": {
        "tags": [
          "metrics"
        ],
        "summary": "Returns Prometheus metrics.",
        "description": "Region is mandatory. Filter_tags (if any) should be written as string containing tag_name=tag_value\n\nResults are estimated for one hour of use by default.\n\nExample query: http://localhost:8000/metrics?aws_region=eu-west-3&amp;filter_tag=Name=boatest&amp;filter_tag=OtherTag=other-value&amp;use_duration_hours=1.0&amp;include_storage=true",
        "operationId": "metrics",
        "parameters": [
          {
            "name": "aws_region",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "filter_tags",
            "in": "query",
            "schema": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "nullable": true
            }
          },
          {
            "name": "use_duration_hours",
            "in": "query",
            "schema": {
              "type": "number",
              "format": "float",
              "nullable": true
            }
          },
          {
            "name": "include_block_storage",
            "in": "query",
            "schema": {
              "type": "boolean",
              "nullable": true
            }
          }
        ],
        "responses": {
          "200": {
            "description": "",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "/inventory": {
      "get": {
        "tags": [
          "inventory"
        ],
        "summary": "Returns the inventory as json.",
        "description": "Region is mandatory. Filter_tags (if any) should be written as string containing tag_name=tag_value\n\nExample query: http://localhost:8000/inventorynew?aws_region=eu-west-3&amp;filter_tag=Name=boatest&amp;filter_tag=OtherTag=other-value",
        "operationId": "inventory",
        "parameters": [
          {
            "name": "aws_region",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "filter_tags",
            "in": "query",
            "schema": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "nullable": true
            }
          },
          {
            "name": "include_block_storage",
            "in": "query",
            "schema": {
              "type": "boolean",
              "nullable": true
            }
          }
        ],
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Inventory"
                }
              }
            }
          }
        }
      }
    },
    "/impacts": {
      "get": {
        "tags": [
          "impacts"
        ],
        "summary": "Returns the impacts (use and embedded) as json.",
        "description": "Region is mandatory. Filter_tags (if any) should be written as string containing tag_name=tag_value\n\nExample query: http://localhost:8000/impacts?aws_region=eu-west-3&amp;filter_tag=Name=boatest&amp;filter_tag=OtherTag=other-value&amp;use_duration_hours=1.0",
        "operationId": "impacts",
        "parameters": [
          {
            "name": "aws_region",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "filter_tags",
            "in": "query",
            "schema": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "nullable": true
            }
          },
          {
            "name": "use_duration_hours",
            "in": "query",
            "schema": {
              "type": "number",
              "format": "float",
              "nullable": true
            }
          },
          {
            "name": "verbose_output",
            "in": "query",
            "schema": {
              "type": "boolean",
              "nullable": true
            }
          },
          {
            "name": "include_block_storage",
            "in": "query",
            "schema": {
              "type": "boolean",
              "nullable": true
            }
          }
        ],
        "responses": {
          "200": {
            "description": "",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EstimatedInventory"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "Inventory": {
        "description": "Inventory: a list of resources",
        "type": "object",
        "required": [
          "resources"
        ],
        "properties": {
          "resources": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CloudResource"
            }
          },
          "executionStatistics": {
            "allOf": [
              {
                "$ref": "#/components/schemas/ExecutionStatistics"
              }
            ],
            "nullable": true
          }
        }
      },
      "CloudResource": {
        "description": "A cloud resource (could be an instance, function or any other resource)",
        "type": "object",
        "required": [
          "id",
          "location",
          "provider",
          "resource_details",
          "tags"
        ],
        "properties": {
          "provider": {
            "$ref": "#/components/schemas/CloudProvider"
          },
          "id": {
            "type": "string"
          },
          "location": {
            "$ref": "#/components/schemas/UsageLocation"
          },
          "resource_details": {
            "$ref": "#/components/schemas/ResourceDetails"
          },
          "tags": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CloudResourceTag"
            }
          }
        }
      },
      "CloudProvider": {
        "type": "string",
        "enum": [
          "AWS",
          "OVH"
        ]
      },
      "UsageLocation": {
        "description": "The location where cloud resources are running.\n\nTODO! the usage location should be abstracted and vendor specific implementation should be part of the cloud_provider model (region names are tied to a specific cloud provider)",
        "type": "object",
        "required": [
          "aws_region",
          "iso_country_code"
        ],
        "properties": {
          "aws_region": {
            "description": "The AWS region (like eu-west-1)",
            "type": "string"
          },
          "iso_country_code": {
            "description": "The 3-letters ISO country code corresponding to the country of the aws_region",
            "type": "string"
          }
        }
      },
      "ResourceDetails": {
        "oneOf": [
          {
            "type": "string",
            "enum": [
              "ObjectStorage"
            ]
          },
          {
            "type": "object",
            "required": [
              "Instance"
            ],
            "properties": {
              "Instance": {
                "type": "object",
                "required": [
                  "instance_type"
                ],
                "properties": {
                  "instance_type": {
                    "type": "string"
                  },
                  "usage": {
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/InstanceUsage"
                      }
                    ],
                    "nullable": true
                  }
                }
              }
            },
            "additionalProperties": false
          },
          {
            "type": "object",
            "required": [
              "BlockStorage"
            ],
            "properties": {
              "BlockStorage": {
                "type": "object",
                "required": [
                  "storage_type"
                ],
                "properties": {
                  "storage_type": {
                    "type": "string"
                  },
                  "usage": {
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/StorageUsage"
                      }
                    ],
                    "nullable": true
                  },
                  "attached_instances": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/StorageAttachment"
                    },
                    "nullable": true
                  }
                }
              }
            },
            "additionalProperties": false
          }
        ]
      },
      "InstanceUsage": {
        "type": "object",
        "required": [
          "average_cpu_load",
          "state",
          "usage_duration_seconds"
        ],
        "properties": {
          "average_cpu_load": {
            "type": "number",
            "format": "double"
          },
          "usage_duration_seconds": {
            "type": "integer",
            "format": "uint32",
            "minimum": 0.0
          },
          "state": {
            "$ref": "#/components/schemas/InstanceState"
          }
        }
      },
      "InstanceState": {
        "type": "string",
        "enum": [
          "Running",
          "Stopped"
        ]
      },
      "StorageUsage": {
        "type": "object",
        "required": [
          "size_gb",
          "usage_duration_seconds"
        ],
        "properties": {
          "size_gb": {
            "type": "integer",
            "format": "int32"
          },
          "usage_duration_seconds": {
            "type": "integer",
            "format": "uint32",
            "minimum": 0.0
          }
        }
      },
      "StorageAttachment": {
        "type": "object",
        "required": [
          "instance_id"
        ],
        "properties": {
          "instance_id": {
            "type": "string"
          }
        }
      },
      "CloudResourceTag": {
        "description": "A tag (just a mandatory key + optional value)",
        "type": "object",
        "required": [
          "key"
        ],
        "properties": {
          "key": {
            "type": "string"
          },
          "value": {
            "type": "string",
            "nullable": true
          }
        }
      },
      "ExecutionStatistics": {
        "description": "Statistics about program execution",
        "type": "object",
        "required": [
          "impact_estimation_duration",
          "inventory_duration",
          "total_duration"
        ],
        "properties": {
          "inventory_duration": {
            "$ref": "#/components/schemas/Duration"
          },
          "impact_estimation_duration": {
            "$ref": "#/components/schemas/Duration"
          },
          "total_duration": {
            "$ref": "#/components/schemas/Duration"
          }
        }
      },
      "Duration": {
        "type": "object",
        "required": [
          "nanos",
          "secs"
        ],
        "properties": {
          "secs": {
            "type": "integer",
            "format": "uint64",
            "minimum": 0.0
          },
          "nanos": {
            "type": "integer",
            "format": "uint32",
            "minimum": 0.0
          }
        }
      },
      "EstimatedInventory": {
        "description": "An estimated inventory: impacting resources with their estimated impacts",
        "type": "object",
        "required": [
          "impactingResources"
        ],
        "properties": {
          "impactingResources": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CloudResourceWithImpacts"
            }
          },
          "executionStatistics": {
            "allOf": [
              {
                "$ref": "#/components/schemas/ExecutionStatistics"
              }
            ],
            "nullable": true
          }
        }
      },
      "CloudResourceWithImpacts": {
        "type": "object",
        "required": [
          "cloud_resource",
          "impacts_duration_hours"
        ],
        "properties": {
          "cloud_resource": {
            "$ref": "#/components/schemas/CloudResource"
          },
          "impacts_values": {
            "description": "The impacts",
            "allOf": [
              {
                "$ref": "#/components/schemas/ImpactsValues"
              }
            ],
            "nullable": true
          },
          "impacts_duration_hours": {
            "description": "The duration for which impacts are calculated",
            "type": "number",
            "format": "float"
          }
        }
      },
      "ImpactsValues": {
        "description": "Impacts of an individual resource",
        "type": "object",
        "required": [
          "adp_manufacture_kgsbeq",
          "adp_use_kgsbeq",
          "gwp_manufacture_kgco2eq",
          "gwp_use_kgco2eq",
          "pe_manufacture_megajoules",
          "pe_use_megajoules"
        ],
        "properties": {
          "adp_manufacture_kgsbeq": {
            "type": "number",
            "format": "double"
          },
          "adp_use_kgsbeq": {
            "type": "number",
            "format": "double"
          },
          "pe_manufacture_megajoules": {
            "type": "number",
            "format": "double"
          },
          "pe_use_megajoules": {
            "type": "number",
            "format": "double"
          },
          "gwp_manufacture_kgco2eq": {
            "type": "number",
            "format": "double"
          },
          "gwp_use_kgco2eq": {
            "type": "number",
            "format": "double"
          },
          "raw_data": {
            "nullable": true
          }
        }
      }
    }
  }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="output-data"><a class="header" href="#output-data">Output data</a></h1>
<p>Cloud scanner CLI and serverless application return data as <em>json</em> or <em>Open Metrics</em> (Prometheus) format.</p>
<h2 id="json-cli-output-the-default"><a class="header" href="#json-cli-output-the-default">JSON CLI output (the default)</a></h2>
<p>Cloud scanner returns a json array of instances metadata.</p>
<p>‚ö† Returns <em>empty</em> impacts when the <em>instance type</em> is not known in Boavizta database</p>
<pre><code class="language-json">[
  {
    "instance_id": "i-001dc0ebbf9cb25c0",
    "instance_type": "t2.micro",
    "usage_data": {
      "use_duration_hours": 5,
      "usage_location": "IRL"
    },
    "impacts": {}
  },
  {
    "instance_id": "i-004599844f7c24814",
    "instance_type": "t2.small",
    "usage_data": {
      "use_duration_hours": 5,
      "usage_location": "IRL"
    },
    "impacts": {}
  },
  {
    "instance_id": "i-075444d7293d8bd76",
    "instance_type": "t2.micro",
    "usage_data": {
      "use_duration_hours": 5,
      "usage_location": "IRL"
    },
    "impacts": {}
  },
  {
    "instance_id": "i-033df52f12f30ca66",
    "instance_type": "m6g.xlarge",
    "usage_data": {
      "use_duration_hours": 5,
      "usage_location": "IRL"
    },
    "impacts": {
      "adp": {
        "manufacture": 0.0084,
        "unit": "kgSbeq",
        "use": 1.7e-9
      },
      "gwp": {
        "manufacture": 87,
        "unit": "kgCO2eq",
        "use": 0.029
      },
      "pe": {
        "manufacture": 1100,
        "unit": "MJ",
        "use": 0.82
      }
    }
  }
]
</code></pre>
<h2 id="server-mode-json-results"><a class="header" href="#server-mode-json-results">Server mode json results</a></h2>
<p>The format of the json results is slightly more complex in server mode.</p>
<p>When run in server mode, the server exposes an OpenAPI specification at <a href="http://127.0.0.1:8000/openapi.json">http://127.0.0.1:8000/openapi.json</a> and a swagger-ui:
<a href="http://127.0.0.1:8000/swagger-ui/">http://127.0.0.1:8000/swagger-ui/</a></p>
<p>See  <a href="reference/./openapi-server-mode.html">OpenAPI specification in server mode</a></p>
<h2 id="openmetricsprometheus-output"><a class="header" href="#openmetricsprometheus-output">OpenMetrics/Prometheus output</a></h2>
<p>As CLI application, If using <code>--as-metrics</code> or <code>-m</code>  option or the <code>serve</code> command, cloud-scanner returns consolidated results as OpenMetric/Prometheus format instead of json details.
This is also the default format of the serverless app <code>metrics</code> route.</p>
<p>When using the metric output format, you get 2 sets of metrics</p>
<ul>
<li>Metrics named: <em>boavizta_xxxxx</em> are <em>summary</em> metrics (total number of resources, summed impacts, a.s.o)</li>
<li>Metrics named <em>boavizta_resource_yyy</em> are specific to individual resources. The metric label can be filtered to identify resource.</li>
</ul>
<pre><code class="language-sh">cargo run -- --as-metrics estimate -u 1 
</code></pre>
<p>Returns:</p>
<pre><code class="language-sh"># HELP boavizta_number_of_resources_total Number of resources detected during the inventory.
# TYPE boavizta_number_of_resources_total gauge
boavizta_number_of_resources_total{awsregion="eu-west-1",country="IRL"} 4
# HELP boavizta_number_of_resources_assessed Number of resources that were considered in the estimation of impacts.
# TYPE boavizta_number_of_resources_assessed gauge
boavizta_number_of_resources_assessed{awsregion="eu-west-1",country="IRL"} 4
# HELP boavizta_duration_of_use_hours Use duration considered to estimate impacts.
# TYPE boavizta_duration_of_use_hours gauge
boavizta_duration_of_use_hours{awsregion="eu-west-1",country="IRL"} 1.0
# HELP boavizta_pe_manufacture_megajoules Energy consumed for manufacture.
# TYPE boavizta_pe_manufacture_megajoules gauge
boavizta_pe_manufacture_megajoules{awsregion="eu-west-1",country="IRL"} 0.0704
# HELP boavizta_pe_use_megajoules Energy consumed during use.
# TYPE boavizta_pe_use_megajoules gauge
boavizta_pe_use_megajoules{awsregion="eu-west-1",country="IRL"} 0.2636
# HELP boavizta_adp_manufacture_kgsbeq Abiotic resources depletion potential of manufacture.
# TYPE boavizta_adp_manufacture_kgsbeq gauge
boavizta_adp_manufacture_kgsbeq{awsregion="eu-west-1",country="IRL"} 8.3e-7
# HELP boavizta_adp_use_kgsbeq Abiotic resources depletion potential of use.
# TYPE boavizta_adp_use_kgsbeq gauge
boavizta_adp_use_kgsbeq{awsregion="eu-west-1",country="IRL"} 5.387e-10
# HELP boavizta_gwp_manufacture_kgco2eq Global Warming Potential of manufacture.
# TYPE boavizta_gwp_manufacture_kgco2eq gauge
boavizta_gwp_manufacture_kgco2eq{awsregion="eu-west-1",country="IRL"} 0.00532
# HELP boavizta_gwp_use_kgco2eq Global Warming Potential of use.
# TYPE boavizta_gwp_use_kgco2eq gauge
boavizta_gwp_use_kgco2eq{awsregion="eu-west-1",country="IRL"} 0.009430000000000001
# HELP boavizta_resource_duration_of_use_hours Use duration considered to estimate impacts.
# TYPE boavizta_resource_duration_of_use_hours gauge
boavizta_resource_duration_of_use_hours{awsregion="eu-west-1",country="IRL",resource_type="Instance",resource_id="i-033df52f12f30ca66",resource_tags="[CloudResourceTag { key: "Name", value: Some("test-boavizta") }, CloudResourceTag { key: "CustomTagNameForDebug", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "CreatorName", value: Some("olivierdemeringoadm") }]",resource_state="Stopped"} 1.0
boavizta_resource_duration_of_use_hours{awsregion="eu-west-1",country="IRL",resource_type="Instance",resource_id="i-0a3e6b8cdb50c49b8",resource_tags="[CloudResourceTag { key: "CustomTagNameForDebug", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "appname", value: Some("app1") }, CloudResourceTag { key: "created_by", value: Some("demeringo") }, CloudResourceTag { key: "CreatorName", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "Name", value: Some("boavizta-c5n.xlarge") }]",resource_state="Stopped"} 1.0
boavizta_resource_duration_of_use_hours{awsregion="eu-west-1",country="IRL",resource_type="Instance",resource_id="i-03c8f84a6318a8186",resource_tags="[CloudResourceTag { key: "Name", value: Some("test-boapi") }, CloudResourceTag { key: "CreatorName", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "CustomTagNameForDebug", value: Some("olivierdemeringoadm") }]",resource_state="Running"} 1.0
boavizta_resource_duration_of_use_hours{awsregion="eu-west-1",country="IRL",resource_type="Instance",resource_id="i-003ea8da7bb9bfff9",resource_tags="[CloudResourceTag { key: "CustomTagNameForDebug", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "CreatorName", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "Name", value: Some("test-boavizta-2") }]",resource_state="Running"} 1.0
# HELP boavizta_resource_pe_embedded_megajoules Energy consumed for manufacture.
# TYPE boavizta_resource_pe_embedded_megajoules gauge
boavizta_resource_pe_embedded_megajoules{awsregion="eu-west-1",country="IRL",resource_type="Instance",resource_id="i-003ea8da7bb9bfff9",resource_tags="[CloudResourceTag { key: "CustomTagNameForDebug", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "CreatorName", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "Name", value: Some("test-boavizta-2") }]",resource_state="Running"} 0.021
boavizta_resource_pe_embedded_megajoules{awsregion="eu-west-1",country="IRL",resource_type="Instance",resource_id="i-0a3e6b8cdb50c49b8",resource_tags="[CloudResourceTag { key: "CustomTagNameForDebug", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "appname", value: Some("app1") }, CloudResourceTag { key: "created_by", value: Some("demeringo") }, CloudResourceTag { key: "CreatorName", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "Name", value: Some("boavizta-c5n.xlarge") }]",resource_state="Stopped"} 0.017
boavizta_resource_pe_embedded_megajoules{awsregion="eu-west-1",country="IRL",resource_type="Instance",resource_id="i-03c8f84a6318a8186",resource_tags="[CloudResourceTag { key: "Name", value: Some("test-boapi") }, CloudResourceTag { key: "CreatorName", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "CustomTagNameForDebug", value: Some("olivierdemeringoadm") }]",resource_state="Running"} 0.0114
boavizta_resource_pe_embedded_megajoules{awsregion="eu-west-1",country="IRL",resource_type="Instance",resource_id="i-033df52f12f30ca66",resource_tags="[CloudResourceTag { key: "Name", value: Some("test-boavizta") }, CloudResourceTag { key: "CustomTagNameForDebug", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "CreatorName", value: Some("olivierdemeringoadm") }]",resource_state="Stopped"} 0.021
# HELP boavizta_resource_pe_use_megajoules Energy consumed during use.
# TYPE boavizta_resource_pe_use_megajoules gauge
boavizta_resource_pe_use_megajoules{awsregion="eu-west-1",country="IRL",resource_type="Instance",resource_id="i-003ea8da7bb9bfff9",resource_tags="[CloudResourceTag { key: "CustomTagNameForDebug", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "CreatorName", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "Name", value: Some("test-boavizta-2") }]",resource_state="Running"} 0.082
boavizta_resource_pe_use_megajoules{awsregion="eu-west-1",country="IRL",resource_type="Instance",resource_id="i-03c8f84a6318a8186",resource_tags="[CloudResourceTag { key: "Name", value: Some("test-boapi") }, CloudResourceTag { key: "CreatorName", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "CustomTagNameForDebug", value: Some("olivierdemeringoadm") }]",resource_state="Running"} 0.0126
boavizta_resource_pe_use_megajoules{awsregion="eu-west-1",country="IRL",resource_type="Instance",resource_id="i-033df52f12f30ca66",resource_tags="[CloudResourceTag { key: "Name", value: Some("test-boavizta") }, CloudResourceTag { key: "CustomTagNameForDebug", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "CreatorName", value: Some("olivierdemeringoadm") }]",resource_state="Stopped"} 0.081
boavizta_resource_pe_use_megajoules{awsregion="eu-west-1",country="IRL",resource_type="Instance",resource_id="i-0a3e6b8cdb50c49b8",resource_tags="[CloudResourceTag { key: "CustomTagNameForDebug", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "appname", value: Some("app1") }, CloudResourceTag { key: "created_by", value: Some("demeringo") }, CloudResourceTag { key: "CreatorName", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "Name", value: Some("boavizta-c5n.xlarge") }]",resource_state="Stopped"} 0.088
# HELP boavizta_resource_adp_embedded_kgsbeq Abiotic resources depletion potential of embedded impacts.
# TYPE boavizta_resource_adp_embedded_kgsbeq gauge
boavizta_resource_adp_embedded_kgsbeq{awsregion="eu-west-1",country="IRL",resource_type="Instance",resource_id="i-033df52f12f30ca66",resource_tags="[CloudResourceTag { key: "Name", value: Some("test-boavizta") }, CloudResourceTag { key: "CustomTagNameForDebug", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "CreatorName", value: Some("olivierdemeringoadm") }]",resource_state="Stopped"} 2.1e-7
boavizta_resource_adp_embedded_kgsbeq{awsregion="eu-west-1",country="IRL",resource_type="Instance",resource_id="i-003ea8da7bb9bfff9",resource_tags="[CloudResourceTag { key: "CustomTagNameForDebug", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "CreatorName", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "Name", value: Some("test-boavizta-2") }]",resource_state="Running"} 2.1e-7
boavizta_resource_adp_embedded_kgsbeq{awsregion="eu-west-1",country="IRL",resource_type="Instance",resource_id="i-03c8f84a6318a8186",resource_tags="[CloudResourceTag { key: "Name", value: Some("test-boapi") }, CloudResourceTag { key: "CreatorName", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "CustomTagNameForDebug", value: Some("olivierdemeringoadm") }]",resource_state="Running"} 1.8e-7
boavizta_resource_adp_embedded_kgsbeq{awsregion="eu-west-1",country="IRL",resource_type="Instance",resource_id="i-0a3e6b8cdb50c49b8",resource_tags="[CloudResourceTag { key: "CustomTagNameForDebug", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "appname", value: Some("app1") }, CloudResourceTag { key: "created_by", value: Some("demeringo") }, CloudResourceTag { key: "CreatorName", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "Name", value: Some("boavizta-c5n.xlarge") }]",resource_state="Stopped"} 2.3e-7
# HELP boavizta_resource_adp_use_kgsbeq Abiotic resources depletion potential of use.
# TYPE boavizta_resource_adp_use_kgsbeq gauge
boavizta_resource_adp_use_kgsbeq{awsregion="eu-west-1",country="IRL",resource_type="Instance",resource_id="i-0a3e6b8cdb50c49b8",resource_tags="[CloudResourceTag { key: "CustomTagNameForDebug", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "appname", value: Some("app1") }, CloudResourceTag { key: "created_by", value: Some("demeringo") }, CloudResourceTag { key: "CreatorName", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "Name", value: Some("boavizta-c5n.xlarge") }]",resource_state="Stopped"} 1.81e-10
boavizta_resource_adp_use_kgsbeq{awsregion="eu-west-1",country="IRL",resource_type="Instance",resource_id="i-033df52f12f30ca66",resource_tags="[CloudResourceTag { key: "Name", value: Some("test-boavizta") }, CloudResourceTag { key: "CustomTagNameForDebug", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "CreatorName", value: Some("olivierdemeringoadm") }]",resource_state="Stopped"} 1.65e-10
boavizta_resource_adp_use_kgsbeq{awsregion="eu-west-1",country="IRL",resource_type="Instance",resource_id="i-03c8f84a6318a8186",resource_tags="[CloudResourceTag { key: "Name", value: Some("test-boapi") }, CloudResourceTag { key: "CreatorName", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "CustomTagNameForDebug", value: Some("olivierdemeringoadm") }]",resource_state="Running"} 2.57e-11
boavizta_resource_adp_use_kgsbeq{awsregion="eu-west-1",country="IRL",resource_type="Instance",resource_id="i-003ea8da7bb9bfff9",resource_tags="[CloudResourceTag { key: "CustomTagNameForDebug", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "CreatorName", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "Name", value: Some("test-boavizta-2") }]",resource_state="Running"} 1.67e-10
# HELP boavizta_resource_gwp_embedded_kgco2eq Global Warming Potential of embedded impacts.
# TYPE boavizta_resource_gwp_embedded_kgco2eq gauge
boavizta_resource_gwp_embedded_kgco2eq{awsregion="eu-west-1",country="IRL",resource_type="Instance",resource_id="i-003ea8da7bb9bfff9",resource_tags="[CloudResourceTag { key: "CustomTagNameForDebug", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "CreatorName", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "Name", value: Some("test-boavizta-2") }]",resource_state="Running"} 0.0016
boavizta_resource_gwp_embedded_kgco2eq{awsregion="eu-west-1",country="IRL",resource_type="Instance",resource_id="i-033df52f12f30ca66",resource_tags="[CloudResourceTag { key: "Name", value: Some("test-boavizta") }, CloudResourceTag { key: "CustomTagNameForDebug", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "CreatorName", value: Some("olivierdemeringoadm") }]",resource_state="Stopped"} 0.0016
boavizta_resource_gwp_embedded_kgco2eq{awsregion="eu-west-1",country="IRL",resource_type="Instance",resource_id="i-0a3e6b8cdb50c49b8",resource_tags="[CloudResourceTag { key: "CustomTagNameForDebug", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "appname", value: Some("app1") }, CloudResourceTag { key: "created_by", value: Some("demeringo") }, CloudResourceTag { key: "CreatorName", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "Name", value: Some("boavizta-c5n.xlarge") }]",resource_state="Stopped"} 0.0013
boavizta_resource_gwp_embedded_kgco2eq{awsregion="eu-west-1",country="IRL",resource_type="Instance",resource_id="i-03c8f84a6318a8186",resource_tags="[CloudResourceTag { key: "Name", value: Some("test-boapi") }, CloudResourceTag { key: "CreatorName", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "CustomTagNameForDebug", value: Some("olivierdemeringoadm") }]",resource_state="Running"} 0.00082
# HELP boavizta_resource_gwp_use_kgco2eq Global Warming Potential of use.
# TYPE boavizta_resource_gwp_use_kgco2eq gauge
boavizta_resource_gwp_use_kgco2eq{awsregion="eu-west-1",country="IRL",resource_type="Instance",resource_id="i-033df52f12f30ca66",resource_tags="[CloudResourceTag { key: "Name", value: Some("test-boavizta") }, CloudResourceTag { key: "CustomTagNameForDebug", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "CreatorName", value: Some("olivierdemeringoadm") }]",resource_state="Stopped"} 0.00289
boavizta_resource_gwp_use_kgco2eq{awsregion="eu-west-1",country="IRL",resource_type="Instance",resource_id="i-0a3e6b8cdb50c49b8",resource_tags="[CloudResourceTag { key: "CustomTagNameForDebug", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "appname", value: Some("app1") }, CloudResourceTag { key: "created_by", value: Some("demeringo") }, CloudResourceTag { key: "CreatorName", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "Name", value: Some("boavizta-c5n.xlarge") }]",resource_state="Stopped"} 0.00317
boavizta_resource_gwp_use_kgco2eq{awsregion="eu-west-1",country="IRL",resource_type="Instance",resource_id="i-03c8f84a6318a8186",resource_tags="[CloudResourceTag { key: "Name", value: Some("test-boapi") }, CloudResourceTag { key: "CreatorName", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "CustomTagNameForDebug", value: Some("olivierdemeringoadm") }]",resource_state="Running"} 0.00045
boavizta_resource_gwp_use_kgco2eq{awsregion="eu-west-1",country="IRL",resource_type="Instance",resource_id="i-003ea8da7bb9bfff9",resource_tags="[CloudResourceTag { key: "CustomTagNameForDebug", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "CreatorName", value: Some("olivierdemeringoadm") }, CloudResourceTag { key: "Name", value: Some("test-boavizta-2") }]",resource_state="Running"} 0.00292
# EOF
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="serverless-design"><a class="header" href="#serverless-design">Serverless design</a></h1>
<p>We use the <a href="https://www.serverless.com/">serverless framework</a> and the <a href="https://github.com/softprops/serverless-rust">softprops/serverless-rust</a> plugin to ease packaging and deployment as lambda.</p>
<p>The cloud-scanner-cli is wrapped into a set of lambdas functions exposed behind an AWS API gateway.</p>
<p><em>This is certainly not the only way to deploy the application. If you want more control, you could compile, package and deploy the application with Terraform or CDK, but this is not documented yet.</em></p>
<h2 id="serverless-deployment"><a class="header" href="#serverless-deployment">Serverless deployment</a></h2>
<p>When deploying as serverless, <strong>you</strong> have to provide and configure Grafana and Prometheus seprately. This repository <em>only</em> wrapps the cloud-scanner in a lambda.</p>
<p>The recommended serveless deployment is the following.</p>
<p><img src="reference/../images/cloud-scanner-lambda-deployment.excalidraw.png" alt="Where to deploy the scanner as lambda" /></p>
<p>The scanner is deployed as a lambda inside a first region of your account. It performs inventory of other regions.</p>
<ul>
<li>You may restrict to specifc regions by tuning the role of the lambda defined in <code>serverless.yml</code></li>
<li>You can (and should) also deploy Boaviztapi as a lambda or other in your account. This allow to perform scans and evaluate impacts without any inventory data leaking outside your account. Once you have deployed your own instance of BoaviztAPI, tune the <code>BOAVIZTA_API_URL</code> in the <code>serverless.yml</code> file to ensure that cloud-scanner points to your private instance of API. See  <a href="reference/../tutorials/../how-to/using-private-boaviztapi.html">using private Boavizta API</a>.</li>
</ul>
<p>‚ö† Open issue prevents Boavizta API deployment as Lambda (https://github.com/Boavizta/boaviztapi/issues/153). As a workaround we recommend deploying Boavizta API as a docker container  (for example using AWS ECS) . You can still use cloud-scanner itself as serverless application deployed with Lambda.</p>
<h2 id="serverless-routes"><a class="header" href="#serverless-routes">Serverless routes</a></h2>
<h3 id="instance-impacts-as-json"><a class="header" href="#instance-impacts-as-json">Instance impacts as JSON</a></h3>
<p>The <code>scan</code> route returns individual instances metrics in json format (see below, same as CLI)</p>
<p>Use <code>hours_use_time</code> and <code>aws_region</code> parameters in the query</p>
<p>E.g.: <code>https://xxxxx.execute-api.eu-west-1.amazonaws.com/dev/scan?hours_use_time=5&amp;aws_region=eu-west-1</code></p>
<pre><code class="language-json">[
  {
    "instance_id": "i-03c8f84a6318a8186",
    "instance_type": "a1.medium",
    "usage_data": {
      "hours_use_time": 5,
      "time_workload": 0,
      "usage_location": "IRL"
    },
    "impacts": {
      "adp": {
        "manufacture": 0.0063,
        "unit": "kgSbeq",
        "use": 8e-12
      },
      "gwp": {
        "manufacture": 31,
        "unit": "kgCO2eq",
        "use": 0.0001
      },
      "pe": {
        "manufacture": 430,
        "unit": "MJ",
        "use": 0.004
      }
    }
  },
  {
    "instance_id": "i-033df52f12f30ca66",
    "instance_type": "m6g.xlarge",
    "usage_data": {
      "hours_use_time": 5,
      "time_workload": 0,
      "usage_location": "IRL"
    },
    "impacts": {
      "adp": {
        "manufacture": 0.0083,
        "unit": "kgSbeq",
        "use": 8e-10
      },
      "gwp": {
        "manufacture": 83,
        "unit": "kgCO2eq",
        "use": 0.01
      },
      "pe": {
        "manufacture": 1100,
        "unit": "MJ",
        "use": 0.4
      }
    }
  },
  {
    "instance_id": "i-0a3e6b8cdb50c49b8",
    "instance_type": "c5n.xlarge",
    "usage_data": {
      "hours_use_time": 5,
      "time_workload": 0,
      "usage_location": "IRL"
    },
    "impacts": {
      "adp": {
        "manufacture": 0.0086,
        "unit": "kgSbeq",
        "use": 1e-9
      },
      "gwp": {
        "manufacture": 64,
        "unit": "kgCO2eq",
        "use": 0.02
      },
      "pe": {
        "manufacture": 840,
        "unit": "MJ",
        "use": 0.5
      }
    }
  },
  {
    "instance_id": "i-003ea8da7bb9bfff9",
    "instance_type": "m6g.xlarge",
    "usage_data": {
      "hours_use_time": 5,
      "time_workload": 0,
      "usage_location": "IRL"
    },
    "impacts": {
      "adp": {
        "manufacture": 0.0083,
        "unit": "kgSbeq",
        "use": 8e-10
      },
      "gwp": {
        "manufacture": 83,
        "unit": "kgCO2eq",
        "use": 0.01
      },
      "pe": {
        "manufacture": 1100,
        "unit": "MJ",
        "use": 0.4
      }
    }
  }
]
</code></pre>
<h3 id="account-impacts-as-metrics"><a class="header" href="#account-impacts-as-metrics">Account impacts as metrics</a></h3>
<p>The <code>metrics</code> route returns aggregated account metrics <em>for one hour of use</em> in Prometheus format.</p>
<p>Use <code>aws_region</code> parameters in the query.</p>
<p>E.g.: <code>https://xxxxx.execute-api.eu-west-1.amazonaws.com/dev/metrics?aws_region=eu-central-1</code></p>
<pre><code class="language-text"># HELP boavizta_number_of_instances_total Number of instances detected during the scan.
# TYPE boavizta_number_of_instances_total gauge
boavizta_number_of_instances_total{awsregion="eu-central-1",country="DEU"} 7
# HELP boavizta_number_of_instances_assessed Number of instances that were considered in the measure.
# TYPE boavizta_number_of_instances_assessed gauge
boavizta_number_of_instances_assessed{awsregion="eu-central-1",country="DEU"} 5
# HELP boavizta_duration_of_use_hours Number of instances detected during the scan.
# TYPE boavizta_duration_of_use_hours gauge
boavizta_duration_of_use_hours{awsregion="eu-central-1",country="DEU"} 1.0
# HELP boavizta_pe_manufacture_megajoules Power consumed for manufacture.
# TYPE boavizta_pe_manufacture_megajoules gauge
boavizta_pe_manufacture_megajoules{awsregion="eu-central-1",country="DEU"} 1760.0
# HELP boavizta_pe_use_megajoules Power consumed during usage.
# TYPE boavizta_pe_use_megajoules gauge
boavizta_pe_use_megajoules{awsregion="eu-central-1",country="DEU"} 0.86
# EOF
</code></pre>
<p>See also <a href="reference/../how-to/set-up-dashboard.html">Set up monitoring dashboard</a> for an example of scrapping and displaying these metrics.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="limitations-and-perimeter"><a class="header" href="#limitations-and-perimeter">Limitations and perimeter</a></h1>
<p>We do our best to offer accurate estimations of impacts.
But these figures should  still be considered with a grain of salt.</p>
<blockquote>
<p>All models are wrong, but some are useful.</p>
</blockquote>
<p>The Boavizta impact data result from a modelling effort. It is important to consider:</p>
<ol>
<li>the limited Perimeter of the resources that cloud-scanner takes into account.</li>
<li>the limits of estimations methodology.</li>
</ol>
<h2 id="perimeter--scope"><a class="header" href="#perimeter--scope">Perimeter / scope</a></h2>
<p>Cloud scanner <em>only</em> estimates the impacts of your AWS EC2  instances, and optionally block storage.</p>
<p>Several significant aspects of the global impacts of cloud usage are <strong>excluded</strong>:</p>
<ul>
<li>It only estimate impacts of <em>compute</em> instances (EC2 Virtual Machines) and optionally block storage (HDD, SSD volumes).</li>
<li>Cloud scanner does not take into account the PUE of the data center. See <a href="https://github.com/Boavizta/cloud-scanner/issues/422">Add an option to override PUE in the queries or cli option ¬∑ Issue #422 ¬∑ Boavizta/cloud-scanner</a></li>
<li>Cloud scanner does not take into account the surrounding cloud infrastructure (network, control plan).</li>
<li>For <strong>storage</strong> (experimental feature), <strong>only</strong> the impacts of <strong>manufacture</strong> are counted. The impacts of the <em>use</em> phase are <em>not</em> counted. At the moment, Boavizta API returns only the impacts of the <em>manufacturing</em> phase for HDD and SSD. Furthermore the impacts of storage <em>are likely overestimated</em>. They are calculated by taking into account the size of the logical volume. In reality, a volume that is not full may not claim the full space on a physical device, which would result in smaller impacts.</li>
<li>do not take into account the <em>over-commit</em> (mutualization) or <em>over-provisioning</em>(redundancy) that cloud provider may apply to provide the service.</li>
<li>do not account managed services (like DB as a service or Containers as a service).</li>
<li>do not account serverless (lambda) compute.</li>
<li>unsupported instance types returns zero for their impacts.</li>
<li>Cloud scanner does not provide error margins <a href="https://github.com/Boavizta/boaviztapi/issues/147">https://github.com/Boavizta/boaviztapi/issues/147</a>.</li>
</ul>
<h2 id="other-limits"><a class="header" href="#other-limits">Other limits</a></h2>
<h3 id="instances-supported"><a class="header" href="#instances-supported">Instances supported</a></h3>
<p>Cloud scanner supports all instances types of Boavizta API. But when a specific instance type cannot be matched with the Boavizta data set, Cloud-scanner returns empty impacts (i.e. zeroed impact values).</p>
<h3 id="carbon-intensity-of-electricity-is-not-real-time"><a class="header" href="#carbon-intensity-of-electricity-is-not-real-time">Carbon intensity of electricity is not real time</a></h3>
<p>Carbon intensity of electricity is not real time. It uses and yearly average corresponding to the country where the data center is located. This is more related to the API itself, see <a href="https://github.com/Boavizta/boaviztapi/issues/117">https://github.com/Boavizta/boaviztapi/issues/117</a> and general Boavizta API methodology.</p>
<h3 id="we-do-not-provide-margins-of-error"><a class="header" href="#we-do-not-provide-margins-of-error">We do not provide margins of error</a></h3>
<p>Cloud scanner is not yet able to provide error margin related to it‚Äôs estimation. Note that there is ongoing work on Boavizta API to provide more details about the error margins: <a href="https://github.com/Boavizta/boaviztapi/issues/147">https://github.com/Boavizta/boaviztapi/issues/147</a></p>
<h3 id="open-issues--bugs"><a class="header" href="#open-issues--bugs">Open issues / bugs</a></h3>
<p>There may be additional identified issues or bugs, see <a href="https://github.com/Boavizta/cloud-scanner/issues">Issues</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="testing"><a class="header" href="#testing">Testing</a></h1>
<h2 id="unit-tests"><a class="header" href="#unit-tests">Unit tests</a></h2>
<p>Unit tests are launched with  <code>cargo test</code> command.</p>
<h2 id="end-to-end-tests"><a class="header" href="#end-to-end-tests">End to end tests</a></h2>
<p>When launched with <code>cargo test -- --include-ignored</code> additional integration tests need:</p>
<ul>
<li>specific instance to be running</li>
<li>aws credentials to be setup</li>
</ul>
<blockquote>
<p>These integration tests require specific instances to be up and running to pass. This means they are tied to a specific cloud account.</p>
</blockquote>
<p>Memo: commands to start or stop instances:</p>
<pre><code class="language-sh"># List instance state
aws ec2 describe-instance-status --include-all-instances --filters Name=instance-state-name,Values='*' --query 'InstanceStatuses[*].{InstanceId: InstanceId, State: InstanceState.Name}' --ouptut table

# start instance 
aws ec2 start-instances --instance-id i-03c8f84a6318a8186

# stop instance
aws ec2 stop-instances --instance-id i-03c8f84a6318a8186
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="mermaid.min.js"></script>
        <script src="mermaid-init.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
